<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Nataliya's Wool Paintings</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f4f4f4; color:#222; }
    nav { position:absolute; top:20px; left:20px; display:flex; flex-direction:column; gap:10px; }
    .nav-button { padding:10px 20px; background:#333; color:#fff; border-radius:6px; border:none; cursor:pointer; font-size:16px; }
    .nav-button:hover { background:#555; }
    .nav-button.inactive { opacity:.5; cursor:default; pointer-events:none; }
    h1 { text-align:center; margin-top:6px; color:#333; }

    .home-content, .gallery-content { display:none; gap:20px; max-width:1200px; margin:0 auto; padding:20px; }
    .home-content { display:flex; align-items:flex-start; justify-content:center; }
    .artist-image { width:300px; height:400px; object-fit:cover; border-radius:10px; background:#ccc; }
    .description { flex:1; text-align:left; font-size:16px; color:#333; }
    @media (max-width:600px) { .home-content { flex-direction:column; align-items:center; } .artist-image { width:200px; height:267px; } .description { text-align:center; } }

    .gallery-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; width:100%; align-items:start; }
    .gallery-item { background:#fff; padding:8px; border-radius:8px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); cursor:pointer; text-align:center; }
    .gallery-item img { width:100%; height:200px; object-fit:cover; border-radius:6px; display:block; margin-bottom:6px; }
    .caption { font-size:14px; color:#444; word-break:break-word; }

    .lightbox { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.8); z-index:1000; }
    .lightbox.active { display:flex; }
    .lightbox img { max-width:90%; max-height:80%; border-radius:8px; box-shadow:0 6px 30px rgba(0,0,0,0.6); }
    .lightbox .nav-arrow { position:absolute; top:50%; transform:translateY(-50%); color:#fff; font-size:40px; padding:12px; cursor:pointer; user-select:none; }
    .lightbox .prev { left:20px; } .lightbox .next { right:20px; }
    .lightbox .close { position:absolute; top:20px; right:20px; color:#fff; font-size:28px; cursor:pointer; }

    .note { text-align:center; color:#666; margin-top:10px; font-size:14px; }
  </style>
</head>
<body>
  <nav>
    <button id="homeBtn" class="nav-button inactive">Home</button>
    <button id="galleryBtn" class="nav-button">Gallery</button>
  </nav>

  <h1>Nataliya's Wool Paintings</h1>

  <section id="home" class="home-content" aria-labelledby="homeHeading">
    <img src="/WoolPaintings/gallery/artist-placeholder.jpg" alt="Artist Portrait" class="artist-image" onerror="this.style.opacity=.5;">
    <div class="description">
      <h2 id="homeHeading">About the artist</h2>
      <p>Welcome to Nataliya's Wool Paintings! Add details about your artistic journey and techniques here.</p>
    </div>
  </section>

  <section id="gallery" class="gallery-content" aria-labelledby="galleryHeading">
    <h2 id="galleryHeading" style="width:100%; text-align:left; margin-bottom:8px;">Gallery</h2>
    <div id="galleryGrid" class="gallery-grid" aria-live="polite"></div>
    <p class="note" id="galleryNote">Loading images…</p>
  </section>

  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <span class="close" id="lbClose" title="Close">&#x2715;</span>
    <span class="nav-arrow prev" id="lbPrev" title="Previous">&#10094;</span>
    <img id="lbImage" alt="Full view">
    <span class="nav-arrow next" id="lbNext" title="Next">&#10095;</span>
  </div>

  <script>
    /* Navigation & normalization */
    const homeBtn = document.getElementById('homeBtn');
    const galleryBtn = document.getElementById('galleryBtn');
    const homeSection = document.getElementById('home');
    const gallerySection = document.getElementById('gallery');

    function showHome(push = true) {
      homeSection.style.display = 'flex';
      gallerySection.style.display = 'none';
      homeBtn.classList.add('inactive');
      galleryBtn.classList.remove('inactive');
      if (push) history.pushState(null,'','/WoolPaintings/');
    }
    function showGallery(push = true) {
      homeSection.style.display = 'none';
      gallerySection.style.display = 'block';
      homeBtn.classList.remove('inactive');
      galleryBtn.classList.add('inactive');
      if (push) history.pushState(null,'','/WoolPaintings/gallery');
      loadGalleryIfNeeded();
    }
    homeBtn.addEventListener('click', ()=> showHome(true));
    galleryBtn.addEventListener('click', ()=> showGallery(true));

    function normalizeHomePathOnLoad() {
      const path = window.location.pathname;
      if (path.endsWith('/home.html') || path.includes('/home')) {
        history.replaceState(null,'','/WoolPaintings/');
        showHome(false);
      }
    }
    normalizeHomePathOnLoad();

    window.addEventListener('popstate', () => {
      if (location.pathname.includes('/gallery')) showGallery(false);
      else showHome(false);
    });

    if (window.location.pathname.includes('/gallery')) showGallery(false);
    else showHome(false);

    /* Gallery scanning (restored/progressive + captions) */
    const galleryGrid = document.getElementById('galleryGrid');
    const galleryNote = document.getElementById('galleryNote');
    const basePath = '/WoolPaintings/gallery/';
    const EXPLICIT_IMAGES = []; // add filenames here to guarantee order

    // same probe patterns you had before
    const patterns = [
      'artist-placeholder.jpg',
      { base: 'img', start: 1, end: 50, ext: '.jpg' },
      { base: 'image', start: 1, end: 50, ext: '.jpg' },
      { base: 'painting', start: 1, end: 50, ext: '.jpg' },
      { base: 'photo', start: 1, end: 50, ext: '.jpg' },
      { base: 'IMG_', start: 1, end: 50, ext: '.jpg', pad: 4 },
      { base: 'DSC', start: 1, end: 50, ext: '.jpg' },
      { base: 'wool', start: 1, end: 50, ext: '.jpg' }
    ];

    function buildCandidates() {
      const list = [];
      for (const p of patterns) {
        if (typeof p === 'string') { list.push(p); continue; }
        for (let i = p.start; i <= p.end; i++) {
          let num = String(i);
          if (p.pad) num = num.padStart(p.pad, '0');
          list.push(`${p.base}${num}${p.ext}`);
        }
      }
      return [...EXPLICIT_IMAGES, ...list];
    }

    function testImageExists(url) {
      return new Promise(resolve=>{
        const img = new Image();
        img.onload = ()=> resolve(true);
        img.onerror = ()=> resolve(false);
        img.src = url + '?_=' + Date.now(); // cache-bust
      });
    }

    let galleryImages = [];
    let probing = false;

    async function loadGalleryIfNeeded() {
      if (galleryGrid.dataset.loaded === 'true' || probing) return;
      probing = true;
      galleryNote.textContent = 'Loading images…';

      const candidates = buildCandidates();
      const found = [];

      // try explicit first (fast)
      for (const name of EXPLICIT_IMAGES) {
        const url = basePath + name;
        if (await testImageExists(url)) {
          found.push(url);
          appendGalleryImage(url);
        }
      }

      // progressive probe: test each candidate and render as we find them
      for (const name of candidates) {
        if (found.length >= 200) break; // safety cap
        if (EXPLICIT_IMAGES.includes(name)) continue;
        const url = basePath + name;
        if (await testImageExists(url)) {
          found.push(url);
          appendGalleryImage(url);
        }
      }

      if (found.length === 0) {
        galleryNote.textContent = 'No gallery images found. If filenames differ, add them to EXPLICIT_IMAGES.';
      } else {
        galleryNote.textContent = `${found.length} image(s) found`;
        setTimeout(()=>{ galleryNote.textContent = ''; }, 1200);
      }

      galleryImages = found.map((s,i)=>({src:s, alt:s.split('/').pop().replace(/\.[^/.]+$/,'')}));
      galleryGrid.dataset.loaded = 'true';
      probing = false;
    }

    // append thumbnail + caption immediately
    function appendGalleryImage(url) {
      const idx = galleryImages.length + Array.from(galleryGrid.children).length; // approximate index until final list assigned
      const filename = url.split('/').pop();
      const item = document.createElement('div');
      item.className = 'gallery-item';
      const img = document.createElement('img');
      img.src = url;
      img.alt = filename;
      img.loading = 'lazy';
      const caption = document.createElement('div');
      caption.className = 'caption';
      caption.textContent = filename.replace(/\.[^/.]+$/,'');
      item.appendChild(img);
      item.appendChild(caption);
      // bind click to openLightbox using the index after final array forms
      item.addEventListener('click', () => {
        // find current index in galleryImages if available, otherwise compute from DOM
        const idxFinal = galleryImages.findIndex(g=>g && g.src === url);
        if (idxFinal !== -1) openLightbox(idxFinal);
        else {
          // fallback: build temporary index by scanning current DOM order
          const nodes = Array.from(galleryGrid.querySelectorAll('.gallery-item img'));
          const domIndex = nodes.findIndex(n=>n.src.includes(filename));
          if (domIndex !== -1) openLightbox(domIndex);
        }
      });
      galleryGrid.appendChild(item);
    }

    function renderGalleryGrid() {
      galleryGrid.innerHTML = '';
      galleryImages.forEach((imgObj, idx) => {
        const item = document.createElement('div');
        item.className = 'gallery-item';
        const img = document.createElement('img');
        img.src = imgObj.src;
        img.alt = imgObj.alt;
        img.loading = 'lazy';
        const caption = document.createElement('div');
        caption.className = 'caption';
        caption.textContent = imgObj.alt;
        item.appendChild(img);
        item.appendChild(caption);
        item.addEventListener('click', ()=> openLightbox(idx));
        galleryGrid.appendChild(item);
      });
    }

    /* Lightbox */
    const lb = document.getElementById('lightbox');
    const lbImage = document.getElementById('lbImage');
    const lbClose = document.getElementById('lbClose');
    const lbPrev = document.getElementById('lbPrev');
    const lbNext = document.getElementById('lbNext');
    let currentIndex = 0;

    function openLightbox(index) {
      if (!galleryImages.length) return;
      currentIndex = index;
      lbImage.src = galleryImages[currentIndex].src;
      lbImage.alt = galleryImages[currentIndex].alt || '';
      lb.classList.add('active');
      lb.setAttribute('aria-hidden','false');
    }
    function closeLightbox() { lb.classList.remove('active'); lb.setAttribute('aria-hidden','true'); lbImage.src=''; }
    function showPrev() { if (!galleryImages.length) return; currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length; lbImage.src = galleryImages[currentIndex].src; }
    function showNext() { if (!galleryImages.length) return; currentIndex = (currentIndex + 1) % galleryImages.length; lbImage.src = galleryImages[currentIndex].src; }

    lbClose.addEventListener('click', closeLightbox);
    lbPrev.addEventListener('click', showPrev);
    lbNext.addEventListener('click', showNext);
    lb.addEventListener('click', e => { if (e.target === lb) closeLightbox(); });
    window.addEventListener('keydown', (e) => {
      if (!lb.classList.contains('active')) return;
      if (e.key === 'ArrowLeft') showPrev();
      if (e.key === 'ArrowRight') showNext();
      if (e.key === 'Escape') closeLightbox();
    });

    // if page opened directly in /gallery route - load immediately
    if (window.location.pathname.includes('/gallery')) loadGalleryIfNeeded();
  </script>
</body>
</html>
